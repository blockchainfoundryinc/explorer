thead
  tr
    th.hidden-xs #{settings.locale.timestamp}
    th.hidden-xs #{settings.locale.tx_hash}
    th Tx Type
    th #{settings.locale.mkt_amount}
tbody
  each tx in txs
    - var time = format_unixtime(tx.timestamp)
    tr
      td.hidden-xs #{time} 
      td.hidden-xs
        a(href='/tx/#{tx.txid}') #{tx.txid}
      td.hiddex-xs #{tx.txtype}
      - var done = false
      - var out = 0
      - var vin = 0
      if(tx.asset_symbol === undefined)
        -//NORMAL TX
        each r in tx.vout
          if r.addresses == address.a_id
            - out = r.amount
        each s in tx.vin
          if s.addresses == address.a_id
            - vin = s.amount
        if out > 0 && vin > 0
          td.info
            - var amount = (out - vin) / 100000000
            if amount < 0
              - amount = amount * -1
              | - #{amount.toFixed(8)} #{settings.symbol}
            else if amount > 0
              | + #{amount.toFixed(8)} #{settings.symbol}
            else
              | #{amount.toFixed(8)} #{settings.symbol}
        else if out > 0
          td.success
            - var amount = out / 100000000
            | + #{amount.toFixed(8)} #{settings.symbol}
        else
          td.danger
            - var amount = vin / 100000000
            | - #{amount.toFixed(8)} #{settings.symbol}
      else
        -//ASSET TX
        -if(tx.txtype === 'assetactivate') {
          -vin = tx.asset_total
        -}else{
          -//if the last out is the same as the address and 0 amount, dont count the vin
          -var fullSend = false;
          -var inMatchesOut = tx.asset_vin[0].address === address.a_id && tx.asset_vout[tx.asset_vout.length-1].address === address.a_id;
          -if (tx.asset_vin[0].address === address.a_id && (tx.asset_vout[tx.asset_vout.length-1].amount === 0 && tx.asset_vout[tx.asset_vout.length-1].address !== address.a_id)) {
            -vin = tx.asset_vin[0].amount;
          -}else if(tx.asset_vout[tx.asset_vout.length-1].amount === 0 && tx.asset_vout[tx.asset_vout.length-1].address === address.a_id) {
            -fullSend = true;
          -}

          -if(vin > 0 || fullSend) {
            -console.log("VIN0orFullsend");
            -for(var s = 0; s < tx.asset_vout.length; s++) {
              -if(tx.asset_vout[s].address !== address.a_id) {
                -out += tx.asset_vout[s].amount;
              -}
            -}
          -}else{
            -console.log("ELSE");
            -for(var s = 0; s < tx.asset_vout.length; s++) {
              -if(tx.asset_vout[s].address === address.a_id) {
                -vin += tx.asset_vout[s].amount;
              -}
            -}
          -}

          -console.log(tx.txid, "vin:", vin, "vout", out);
        -}

        if (out > 0 && vin > 0) || inMatchesOut
          td.info
            - var amount = (vin - out);
            if amount < 0
              - amount = amount * -1
              | - #{formatAsNumber(amount, 8)} #{tx.asset_symbol}
            else if amount > 0
              | + #{amount.toFixed(8)} #{tx.asset_symbol}
            else
              | #{amount.toFixed(8)} #{tx.asset_symbol}
        else if vin > 0
          td.success
            - var amount = vin
            | + #{formatAsNumber(amount, 8)} #{tx.asset_symbol}
        else
          td.danger
            - var amount = out
            | - #{formatAsNumber(amount, 8)} #{tx.asset_symbol}